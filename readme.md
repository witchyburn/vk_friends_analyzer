## –û –ø—Ä–æ–µ–∫—Ç–µ
ETL-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥—Ä—É–∑–µ–π –í–ö–æ–Ω—Ç–∞–∫—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π. –ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–µ –¥—Ä—É–∑–µ–π –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π.
## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
* üìà __ETL-–ø—Ä–æ—Ü–µ—Å—Å:__ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é VK API, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ PostgreSQL;
* üîî __–°–∏—Å—Ç–µ–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π:__ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –æ–± —É–¥–∞–ª–∏–≤—à–∏—Ö –¥—Ä—É–∑—å—è—Ö –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö;
* üìä __–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:__ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –≤ Metabase –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ –¥—Ä—É–∑–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + pgAdmin4 –¥–ª—è –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ë–î;
* üê≥ __–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:__ –ü–æ–ª–Ω–∞—è Docker-—Å–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è;
* ‚öôÔ∏è __–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:__ –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ Apache Airflow.
## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```mermaid
graph TB
    A[VK API] --> B[Apache Airflow]
    
    subgraph B [Apache Airflow DAG]
        C[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö]
        D[–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è]
        E[–í–∞–ª–∏–¥–∞—Ü–∏—è]
        H[Telegram –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è]
        
        C --> D
        D --> E
        D --> H        
    end
    
    E --> F[PostgreSQL]
    F --> G[Metabase Dashboard]
    I[pgAdmin4] --> F
```
## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
* Docker & Docker Compose
* VK Access Token —Å –ø—Ä–∞–≤–∞–º–∏ offline, friends
* Telegram Bot Token –∏ Chat ID
### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è __VK Access Token__:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://vk.com/dev
2. –°–æ–∑–¥–∞–π—Ç–µ Standalone-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–æ–ª—É—á–∏—Ç–µ token —Å –ø—Ä–∞–≤–∞–º–∏: friends, offline
###
__Telegram –ë–æ—Ç__:
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –ü–æ–ª—É—á–∏—Ç–µ token –±–æ—Ç–∞
3. –£–∑–Ω–∞–π—Ç–µ –≤–∞—à chat ID (–æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ updates)
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:\
```git clone https://github.com/witchyburn/vk_friends_analyzer.git```\
```cd vk_friends_etl_project```
2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ ```.env``` —Ñ–∞–π–ª:
```
# Analytical DB
DATABASE_USER=your_username
DATABASE_PASSWORD=your_password
DATABASE_NAME=your_dbname

# Airflow DB
AIRFLOW_DB_NAME=your_airflow_dbname
AIRFLOW_DB_USER=your_airflow_username
AIRFLOW_DB_PASSWORD=your_airflow_password

# Metabase DB
METABASE_DB_NAME=your_metabase_dbname
METABASE_DB_USER=your_metabase_username
METABASE_DB_PASSWORD=your_metabase_password

# pgAdmin4 settings
PGADMIN_DEFAULT_EMAIL=admin@example.com
PGADMIN_DEFAULT_PASSWORD=your_password

# Airflow settings
AIRFLOW__CORE__EXECUTOR=LocalExecutor
AIRFLOW__DATABASE__SQL_ALCHEMY_CONN=postgresql+psycopg2://your_airflow_username:your_airflow_password@postgres/your_airflow_dbname
AIRFLOW__WEBSERVER__DEFAULT_USER_USERNAME=airflow
AIRFLOW__WEBSERVER__DEFAULT_USER_PASSWORD=airflow
AIRFLOW__CORE__DEFAULT_TIMEZONE=UTC

# Other
VK_ACCESS_TOKEN=your_token_here
VK_USER_ID=123456789
LOG_LEVEL=INFO
TG_BOT_TOKEN=your_token_here
TG_CHANNEL_ID=-123456789
```
3. –°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª ```postgres/init-databases.sh```:\
```chmod +x postgres/init-databases.sh```
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:\
```docker compose up -d```
5. –û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:
* Airflow: http://localhost:8080
* pgAdmin4: http://localhost:5000
* Metabase: http://localhost:3000 
6. –í Airflow UI –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª __Admin__ -> __Connections__ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ __postgres_default__ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ __–°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞__;
7. –í Airflow UI –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª __Admin__ -> __Variables__ –∏ –≤–Ω–µ—Å–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö __VK_ACCESS_TOKEN__, __VK_USER_ID__, __TG_BOT_TOKEN__, __TG_CHANNEL_ID__ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ __–°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞__);
8. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ 6 –∏ 7 –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∞–≥–∏ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ;
9. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ Metabase, –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î;
10. –í—Å–µ –≥–æ—Ç–æ–≤–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—à–±–æ—Ä–¥!
## üîÑ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
Airflow DAG'–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ 00:10 –∏ 00:15
## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –û–ø–æ–≤–µ—â–µ–Ω–∏—è
üî¥ –£–¥–∞–ª–∏–≤—à–∏–µ –¥—Ä—É–∑—å—è: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫\
üü° –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥—Ä—É–∑—å—è: –û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, –¥–∞–≤–Ω–æ –Ω–µ –∑–∞—Ö–æ–¥–∏–≤—à–∏—Ö –≤ VK\
üü¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
## üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –î–∞—à–±–æ—Ä–¥
Metabase –¥–∞—à–±–æ—Ä–¥ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å:
* –î–∏–Ω–∞–º–∏–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥—Ä—É–∑–µ–π
* –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
* –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥—Ä—É–∑–µ–π
* –î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
* –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –¥—Ä.
###
–ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ __"–°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞"__.
## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏
* Airflow UI: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è DAG
* PostgreSQL: –õ–æ–≥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î
* –§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ ETL –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
## –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
<div align="center">
  <strong>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ Airflow UI</strong><br>
  <img src="assets/airflow_ui_conn.png" alt="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ Airflow UI" width="70%">

  <strong>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ Airflow UI</strong><br>
  <img src="assets/airflow_ui_vars.png" alt="–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ Airflow UI" width="70%">

  <strong>–õ–æ–≥ –∑–∞–¥–∞—á–∏ –≤ Airflow UI</strong><br>
  <img src="assets/airflow_ui_logs.png" alt="–õ–æ–≥ –∑–∞–¥–∞—á–∏ –≤ Airflow UI" width="70%">
    
  <strong>–ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ (—Å—Ç—Ä. 1)</strong><br>
  <img src="assets/dashboard_1.png" alt="–û—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥" width="70%">
    
  <strong>–ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ (—Å—Ç—Ä. 2)</strong><br>
  <img src="assets/dashboard_2.png" alt="–û—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥" width="70%">
</div>

## –õ–∏—Ü–µ–Ω–∑–∏—è
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª LICENSE –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
* [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è VK API](https://dev.vk.com/ru/reference)
* [Running Airflow in Docker](https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html)
* [Metabase Documentation](https://www.metabase.com/docs/latest/)
* [Docker Documentation](https://docs.docker.com/get-started/)
  



